<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EQUIP PEA - Political Economy Analysis Tools</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { font-family: '', sans-serif; box-sizing: border-box; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    .layer-card, .tool-card {
      backdrop-filter: blur(12px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .layer-card:hover, .tool-card:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 10px 30px -10px rgba(99, 102, 241, 0.3); 
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
    }
    
    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes slide-in {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    .animate-float { animation: float 4s ease-in-out infinite; }
    .fade-in { animation: fade-in 0.6s ease-out forwards; }
    .slide-in { animation: slide-in 0.5s ease-out forwards; }
    
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
    ::-webkit-scrollbar-thumb { background: rgba(100,100,100,0.4); border-radius: 3px; }
    
    /* Form Elements */
    textarea, input, select {
      background: rgba(255,255,255,0.05) !important;
      border: 1px solid rgba(255,255,255,0.1) !important;
      color: white !important;
      border-radius: 0.5rem !important;
      padding: 0.75rem !important;
      width: 100%;
      transition: all 0.2s;
    }
    
    textarea:focus, input:focus, select:focus {
      outline: none !important;
      border-color: rgba(99, 102, 241, 0.5) !important;
      background: rgba(255,255,255,0.08) !important;
      box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(99, 102, 241, 0.4) 100%);
      color: #e0e7ff;
      border: 1px solid rgba(99, 102, 241, 0.4);
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      font-weight: 600;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .btn-primary:hover {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.4) 0%, rgba(99, 102, 241, 0.6) 100%);
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.05);
      color: #cbd5e1;
      border: 1px solid rgba(255,255,255,0.1);
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }

    .btn-secondary:hover {
      background: rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.2);
    }

    /* Iceberg Visualization */
    .iceberg-water {
        background: linear-gradient(to bottom, rgba(56, 189, 248, 0.1) 0%, rgba(30, 58, 138, 0.6) 100%);
        border-top: 2px solid rgba(56, 189, 248, 0.5);
    }

    /* Drag and Drop */
    .drop-zone {
      border: 2px dashed rgba(99, 102, 241, 0.3);
      transition: all 0.3s;
    }

    .drop-zone.drag-over {
      border-color: rgba(99, 102, 241, 0.8);
      background: rgba(99, 102, 241, 0.1);
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      background: rgba(16, 185, 129, 0.95);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Matrix Grid */
    .matrix-cell {
      min-height: 100px;
      transition: all 0.2s;
    }

    .matrix-cell:hover {
      background: rgba(99, 102, 241, 0.1);
    }

    /* Progress Indicator */
    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-circle {
      transition: stroke-dashoffset 0.35s;
      transform-origin: 50% 50%;
    }

    /* Tooltips */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: rgba(15, 23, 42, 0.95);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.75rem;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    /* Stakeholder Cards */
    .stakeholder-card {
      cursor: move;
      transition: all 0.2s;
    }

    .stakeholder-card:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }

    /* Readiness Score Display */
    .score-display {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
      border: 2px solid rgba(99, 102, 241, 0.3);
      border-radius: 1rem;
      padding: 1.5rem;
      text-align: center;
    }

    .score-value {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, #6366f1, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
  </style>
</head>
<body class="h-full text-slate-200">
  <div id="app" class="h-full w-full overflow-hidden flex flex-col" style="background: linear-gradient(135deg, #0a0f1c 0%, #111827 50%, #0d1220 100%);">
    
    <header class="sticky top-0 z-40 px-6 py-4 border-b border-white/10 backdrop-blur-xl bg-slate-900/80">
      <div class="max-w-7xl mx-auto flex items-center justify-between flex-wrap gap-4">
        <div class="flex items-center gap-4 cursor-pointer" onclick="showView('overview')">
          <div class="w-12 h-12 rounded-xl flex items-center justify-center animate-float shadow-lg shadow-indigo-500/20" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl font-bold text-white tracking-tight">EQUIP PEA Platform</h1>
            <p class="text-xs text-indigo-300 font-medium tracking-wide uppercase">Political Economy Systems Diagnostic</p>
          </div>
        </div>
        
        <nav class="flex items-center gap-1 bg-white/5 p-1 rounded-lg border border-white/5">
          <button onclick="showView('overview')" id="nav-overview" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-all hover:bg-white/5">Overview</button>
          <button onclick="showView('tools')" id="nav-tools" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-all hover:bg-white/5">Tools</button>
          <button onclick="showView('workflow')" id="nav-workflow" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-all hover:bg-white/5">Methodology</button>
          <button onclick="showView('export')" id="nav-export" class="nav-btn px-4 py-2 rounded-md text-sm font-medium transition-all hover:bg-white/5">Export</button>
        </nav>
      </div>
    </header>

    <main class="flex-1 overflow-y-auto relative scroll-smooth">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8 pb-24">
        
        <!-- Overview Section -->
        <div id="view-overview" class="fade-in space-y-12">
          <div class="text-center py-10">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full mb-6 bg-indigo-500/10 border border-indigo-500/30">
              <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
              <span class="text-xs font-bold text-indigo-300 tracking-wider">PROJECT STATUS: ACTIVE</span>
            </div>
            <h2 class="text-4xl md:text-6xl font-bold text-white mb-6 tracking-tight">Political Economy Analysis</h2>
            <p class="text-lg text-slate-400 max-w-2xl mx-auto leading-relaxed">
              A comprehensive framework for diagnosing Education-to-Employment systems, analyzing power structures, and designing politically feasible reform pathways using the Regime-Niche-Landscape lens.
            </p>
          </div>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="p-6 rounded-2xl bg-white/5 border border-white/10 text-center hover:bg-white/10 transition-colors cursor-pointer">
              <div class="text-4xl font-bold text-indigo-400 mb-1">4</div>
              <div class="text-xs text-slate-500 font-mono uppercase">Analysis Stages</div>
            </div>
            <div class="p-6 rounded-2xl bg-white/5 border border-white/10 text-center hover:bg-white/10 transition-colors cursor-pointer">
              <div class="text-4xl font-bold text-violet-400 mb-1">6</div>
              <div class="text-xs text-slate-500 font-mono uppercase">Target Regions</div>
            </div>
            <div class="p-6 rounded-2xl bg-white/5 border border-white/10 text-center hover:bg-white/10 transition-colors cursor-pointer">
              <div class="text-4xl font-bold text-pink-400 mb-1">9</div>
              <div class="text-xs text-slate-500 font-mono uppercase">Diagnostic Tools</div>
            </div>
            <div class="p-6 rounded-2xl bg-white/5 border border-white/10 text-center hover:bg-white/10 transition-colors cursor-pointer">
              <div class="text-4xl font-bold text-emerald-400 mb-1">AII</div>
              <div class="text-xs text-slate-500 font-mono uppercase">Framework</div>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-6">
             <div class="p-6 rounded-2xl bg-indigo-500/5 border border-indigo-500/20 cursor-pointer hover:bg-indigo-500/10 transition-all group" onclick="showView('tools'); showStage(1)">
                <div class="flex justify-between items-start">
                    <h3 class="text-xl font-bold text-white group-hover:text-indigo-300 transition-colors">Start Diagnostics</h3>
                    <svg class="w-6 h-6 text-indigo-400 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
                </div>
                <p class="mt-2 text-slate-400">Launch the interactive tool suite starting with RNL Mapping.</p>
             </div>
             <div class="p-6 rounded-2xl bg-emerald-500/5 border border-emerald-500/20 cursor-pointer hover:bg-emerald-500/10 transition-all group" onclick="showView('export')">
                <div class="flex justify-between items-start">
                    <h3 class="text-xl font-bold text-white group-hover:text-emerald-300 transition-colors">Export Analysis</h3>
                    <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path></svg>
                </div>
                <p class="mt-2 text-slate-400">Generate comprehensive reports and strategic annexes.</p>
             </div>
          </div>

          <div class="bg-white/5 border border-white/10 rounded-2xl p-8">
            <h3 class="text-2xl font-bold text-white mb-4">About the Framework</h3>
            <p class="text-slate-300 leading-relaxed mb-4">
              This platform implements a <strong>systems innovation lens</strong> to move beyond technical fixes by diagnosing the <strong>"lock-ins"</strong> that maintain the status quo while identifying <strong>"Niche"</strong> actors ready for transformation.
            </p>
            <p class="text-slate-300 leading-relaxed">
              The methodology employs the <strong>Actors-Institutions-Ideas (AII)</strong> framework to analyze power structures, informal rules, and entrenched narratives that resist change in Education-to-Employment systems across the Philippines' priority regions: <span class="text-indigo-300 font-semibold">NCR, Region 1, 2, 3, 4-B, and 7</span>.
            </p>
          </div>
        </div>

        <!-- Tools Section -->
        <div id="view-tools" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-white mb-2">Interactive Diagnostics</h2>
            <p class="text-slate-400">Select a stage to access comprehensive analysis tools.</p>
          </div>

          <div class="flex gap-3 mb-8 overflow-x-auto pb-2 scrollbar-hide">
            <button onclick="showStage(1)" id="stage-btn-1" class="stage-btn px-6 py-3 rounded-xl font-medium text-sm whitespace-nowrap transition-all border border-transparent">
              <span class="block text-xs opacity-70 uppercase tracking-wider mb-1">Stage 1</span>
              System Mapping
            </button>
            <button onclick="showStage(2)" id="stage-btn-2" class="stage-btn px-6 py-3 rounded-xl font-medium text-sm whitespace-nowrap transition-all border border-transparent">
              <span class="block text-xs opacity-70 uppercase tracking-wider mb-1">Stage 2</span>
              Field Data
            </button>
            <button onclick="showStage(3)" id="stage-btn-3" class="stage-btn px-6 py-3 rounded-xl font-medium text-sm whitespace-nowrap transition-all border border-transparent">
              <span class="block text-xs opacity-70 uppercase tracking-wider mb-1">Stage 3</span>
              Analysis
            </button>
            <button onclick="showStage(4)" id="stage-btn-4" class="stage-btn px-6 py-3 rounded-xl font-medium text-sm whitespace-nowrap transition-all border border-transparent">
              <span class="block text-xs opacity-70 uppercase tracking-wider mb-1">Stage 4</span>
              Validation
            </button>
          </div>

          <div id="tool-interface" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

        <!-- Methodology Section -->
        <div id="view-workflow" class="hidden fade-in">
           <div class="max-w-3xl mx-auto space-y-8">
               <div class="text-center mb-10">
                   <h2 class="text-3xl font-bold text-white">Methodology Framework</h2>
                   <p class="text-slate-400 mt-2">The 4-stage execution plan for E2E system reform.</p>
               </div>
               
               <div class="relative pl-8 border-l-2 border-indigo-500/30 pb-8">
                   <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-indigo-500 shadow-lg shadow-indigo-500/50"></div>
                   <h3 class="text-xl font-bold text-white mb-2">1. Mobilization & System Mapping</h3>
                   <div class="bg-white/5 p-4 rounded-lg border border-white/5">
                       <p class="text-slate-300 text-sm mb-3">Categorize stakeholders using the <strong>Regime-Niche-Landscape</strong> framework. Identify macro trends and status quo actors.</p>
                       <ul class="text-slate-400 text-sm space-y-1 list-disc list-inside">
                         <li>Landscape: External pressures forcing change</li>
                         <li>Regime: Established actors maintaining power</li>
                         <li>Niche: Innovators ready for transformation</li>
                       </ul>
                   </div>
               </div>

               <div class="relative pl-8 border-l-2 border-violet-500/30 pb-8">
                   <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-violet-500 shadow-lg shadow-violet-500/50"></div>
                   <h3 class="text-xl font-bold text-white mb-2">2. Field Data Collection</h3>
                   <div class="bg-white/5 p-4 rounded-lg border border-white/5">
                       <p class="text-slate-300 text-sm mb-3">Deploy <strong>Readiness Templates</strong> and conflict-sensitive KII guides. Decode informal rules and partnership potential.</p>
                       <ul class="text-slate-400 text-sm space-y-1 list-disc list-inside">
                         <li>Systemic Readiness Assessment</li>
                         <li>Semi-structured interviews & FGDs</li>
                         <li>Transcription for nuance capture</li>
                       </ul>
                   </div>
               </div>

               <div class="relative pl-8 border-l-2 border-pink-500/30 pb-8">
                   <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-pink-500 shadow-lg shadow-pink-500/50"></div>
                   <h3 class="text-xl font-bold text-white mb-2">3. Analysis & Drafting</h3>
                   <div class="bg-white/5 p-4 rounded-lg border border-white/5">
                       <p class="text-slate-300 text-sm mb-3">Synthesize data using the <strong>Actors-Institutions-Ideas (AII)</strong> matrix. Map the "Iceberg" of systemic constraints.</p>
                       <ul class="text-slate-400 text-sm space-y-1 list-disc list-inside">
                         <li>AII Framework Analysis</li>
                         <li>Systemic Constraint Mapping</li>
                         <li>Hidden lock-ins identification</li>
                       </ul>
                   </div>
               </div>

               <div class="relative pl-8 border-l-2 border-emerald-500/30">
                   <div class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-emerald-500 shadow-lg shadow-emerald-500/50"></div>
                   <h3 class="text-xl font-bold text-white mb-2">4. Validation & Finalization</h3>
                   <div class="bg-white/5 p-4 rounded-lg border border-white/5">
                       <p class="text-slate-300 text-sm mb-3">Iterative workshops to test feasibility. Use <strong>Resistance Mapping</strong> to ensure political buy-in.</p>
                       <ul class="text-slate-400 text-sm space-y-1 list-disc list-inside">
                         <li>Stakeholder validation workshops</li>
                         <li>Consensus-building feedback</li>
                         <li>Political viability assessment</li>
                       </ul>
                   </div>
               </div>
           </div>
        </div>

        <!-- Export Section -->
        <div id="view-export" class="hidden fade-in">
          <div class="mb-8">
            <h2 class="text-3xl font-bold text-white mb-2">Export & Reports</h2>
            <p class="text-slate-400">Generate comprehensive analysis reports and strategic documents.</p>
          </div>

          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-4">Full Analysis Report</h3>
              <p class="text-slate-400 text-sm mb-4">Complete synthesis of all stages including RNL mapping, field data, AII analysis, and validation feedback.</p>
              <button onclick="exportFullReport()" class="btn-primary w-full">
                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path></svg>
                Export Full Report
              </button>
            </div>

            <div class="bg-white/5 border border-white/10 rounded-2xl p-6">
              <h3 class="text-xl font-bold text-white mb-4">Strategic Annex</h3>
              <p class="text-slate-400 text-sm mb-4">Targeted implementation plan listing priority schools/divisions for pilot programs in NCR and two additional regions.</p>
              <button onclick="exportStrategicAnnex()" class="btn-primary w-full">
                <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                Export Strategic Annex
              </button>
            </div>
          </div>

          <div class="mt-8 bg-white/5 border border-white/10 rounded-2xl p-6" id="export-preview">
            <h3 class="text-xl font-bold text-white mb-4">Export Preview</h3>
            <div class="bg-black/20 rounded-lg p-4 font-mono text-sm text-slate-300 h-96 overflow-y-auto" id="export-content">
              <p class="text-slate-500">Export content will appear here...</p>
            </div>
          </div>
        </div>

      </div>
    </main>

    <!-- Tool Modal -->
    <div id="tool-modal" class="fixed inset-0 z-50 hidden" style="background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);">
      <div class="absolute inset-0 overflow-y-auto py-8 px-4">
        <div class="min-h-full flex items-center justify-center">
            <div id="modal-content" class="w-full max-w-6xl rounded-2xl bg-[#0f1422] border border-white/10 shadow-2xl transform transition-all p-6 md:p-8 relative">
            </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

  </div>

  <script>
    // ============================================
    // STATE MANAGEMENT
    // ============================================
    let currentStage = 1;
    const appData = {
        stage1: { 
          landscape: [], 
          regime: [], 
          niche: [],
          deskReview: { nationalTrends: '', regionalContexts: '', preliminaryLockIns: '' }
        },
        stage2: { 
          readinessAssessments: [],
          interviews: [],
          transcripts: []
        },
        stage3: { 
          aii: { actors: '', institutions: '', ideas: '' },
          iceberg: { visible: '', hidden: [] }
        },
        stage4: { 
          validationFeedback: [],
          resistanceMap: [],
          consensus: []
        }
    };

    // Load from localStorage on startup
    function loadState() {
      const saved = localStorage.getItem('equipPEAData');
      if (saved) {
        try {
          Object.assign(appData, JSON.parse(saved));
          console.log('State loaded from localStorage');
        } catch (e) {
          console.error('Error loading state:', e);
        }
      }
    }

    // Save to localStorage
    function saveState() {
      try {
        localStorage.setItem('equipPEAData', JSON.stringify(appData));
        showToast('Progress saved successfully', 'success');
      } catch (e) {
        console.error('Error saving state:', e);
        showToast('Error saving progress', 'error');
      }
    }

    // ============================================
    // NAVIGATION LOGIC
    // ============================================
    function showView(viewName) {
        ['overview', 'tools', 'workflow', 'export'].forEach(v => {
            const el = document.getElementById(`view-${v}`);
            const btn = document.getElementById(`nav-${v}`);
            
            if (v === viewName) {
                el.classList.remove('hidden');
                el.classList.add('fade-in');
                btn.classList.add('bg-white/10', 'text-white');
                btn.classList.remove('text-slate-400');
            } else {
                el.classList.add('hidden');
                btn.classList.remove('bg-white/10', 'text-white');
                btn.classList.add('text-slate-400');
            }
        });
        
        if (viewName === 'tools') showStage(currentStage);
    }

    // ============================================
    // STAGE SELECTION LOGIC
    // ============================================
    function showStage(stageNum) {
        currentStage = stageNum;
        
        // Reset buttons
        document.querySelectorAll('.stage-btn').forEach(btn => {
            btn.className = 'stage-btn px-6 py-3 rounded-xl font-medium text-sm whitespace-nowrap transition-all border border-transparent text-slate-500 hover:text-slate-300 hover:bg-white/5';
        });

        // Activate specific button
        const activeBtn = document.getElementById(`stage-btn-${stageNum}`);
        const colors = {
            1: 'bg-indigo-500/10 text-indigo-300 border-indigo-500/30',
            2: 'bg-violet-500/10 text-violet-300 border-violet-500/30',
            3: 'bg-pink-500/10 text-pink-300 border-pink-500/30',
            4: 'bg-emerald-500/10 text-emerald-300 border-emerald-500/30'
        };
        activeBtn.className = `stage-btn px-6 py-3 rounded-xl font-medium text-sm whitespace-nowrap transition-all border ${colors[stageNum]}`;
        
        renderTools(stageNum);
    }

    // ============================================
    // RENDER TOOL CARDS
    // ============================================
    function renderTools(stage) {
        const container = document.getElementById('tool-interface');
        let html = '';

        if (stage === 1) {
            html += createToolCard(
              'RNL Matrix', 
              'Stakeholder Mapping', 
              'Categorize stakeholders across Landscape, Regime, and Niche dimensions to identify change agents and status quo actors.',
              'openTool("rnl")', 
              'indigo'
            );
            html += createToolCard(
              'Desk Review Synthesis', 
              'Documentation', 
              'Bridge national Education-to-Employment trends with regional political realities and preliminary lock-ins.',
              'openTool("desk")', 
              'indigo'
            );
        } else if (stage === 2) {
            html += createToolCard(
              'Systemic Readiness', 
              'Partnership Assessment', 
              'Filter for political will, partnership capacity, and niche potential across schools and divisions.',
              'openTool("readiness")', 
              'violet'
            );
            html += createToolCard(
              'KII & FGD Guides', 
              'Semi-Structured Interview', 
              'Conflict-sensitive questions to decode informal rules, power dynamics, and political settlements.',
              'openTool("kii")', 
              'violet'
            );
            html += createToolCard(
              'Transcription Service', 
              'Field Notes', 
              'Capture nuance of regional narratives and informal institutional habits for synthesis.',
              'openTool("transcribe")', 
              'violet'
            );
        } else if (stage === 3) {
            html += createToolCard(
              'AII Analysis Matrix', 
              'Actors-Institutions-Ideas', 
              'Synthesize field data to distinguish actors, institutions, and ideas maintaining the status quo.',
              'openTool("aii")', 
              'pink'
            );
            html += createToolCard(
              'Systemic Constraint Map', 
              'Iceberg Model', 
              'Visualize visible symptoms versus hidden lock-ins including elite capture and power structures.',
              'openTool("iceberg")', 
              'pink'
            );
        } else if (stage === 4) {
            html += createToolCard(
              'Validation Workshop', 
              'Stakeholder Engagement', 
              'Iterative feedback loops to test findings and build consensus with regional actors.',
              'openTool("validation")', 
              'emerald'
            );
            html += createToolCard(
              'Resistance Mapping', 
              'Political Viability', 
              'Identify potential resistance from status quo actors and refine politically feasible pathways.',
              'openTool("resistance")', 
              'emerald'
            );
            html += createToolCard(
              'Consensus Tracker', 
              'Feedback Management', 
              'Track stakeholder input and build ownership for reform implementation.',
              'openTool("consensus")', 
              'emerald'
            );
        }

        container.innerHTML = html;
        
        // Animate cards
        document.querySelectorAll('.tool-card').forEach((el, i) => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(10px)';
            setTimeout(() => {
                el.style.transition = 'all 0.4s ease';
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
            }, i * 100);
        });
    }

    function createToolCard(title, subtitle, desc, onclick, color) {
        return `
        <div class="tool-card p-6 rounded-2xl bg-white/5 border border-white/10 cursor-pointer group hover:border-${color}-500/50" onclick='${onclick}'>
            <div class="flex items-center gap-4 mb-4">
                <div class="w-12 h-12 rounded-lg bg-${color}-500/20 flex items-center justify-center text-${color}-400 group-hover:bg-${color}-500 group-hover:text-white transition-all">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                      <line x1="9" y1="3" x2="9" y2="21"/>
                    </svg>
                </div>
                <div>
                    <h3 class="font-bold text-white text-lg">${title}</h3>
                    <span class="text-xs uppercase tracking-wider text-${color}-400 font-bold">${subtitle}</span>
                </div>
            </div>
            <p class="text-sm text-slate-400 leading-relaxed">${desc}</p>
            <div class="mt-4 flex items-center text-${color}-400 text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity">
                Launch Tool <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>
            </div>
        </div>`;
    }

    // ============================================
    // TOOL OPENING SYSTEM (Continued in next message due to length)
    // ============================================
    function openTool(type) {
        const modal = document.getElementById('tool-modal');
        const content = document.getElementById('modal-content');
        modal.classList.remove('hidden');
        
        let html = `<div class="flex justify-between items-center mb-6 pb-4 border-b border-white/10">
            <h2 class="text-2xl font-bold text-white" id="tool-title">Tool Workspace</h2>
            <button onclick="closeModal()" class="text-slate-400 hover:text-white transition-colors">
              <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
        </div>`;

        // ============================================
        // STAGE 1 TOOLS
        // ============================================
        
        if(type === 'rnl') {
            document.getElementById('tool-title').textContent = 'Regime-Niche-Landscape Matrix';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Categorize regional stakeholders to identify change dynamics. Drag stakeholders between categories or add new entries.</p>
            </div>
            
            <div class="grid grid-cols-3 gap-6 mb-6">
                <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/5 p-4 rounded-xl border border-blue-500/20">
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                      <h4 class="text-blue-300 font-bold uppercase text-sm">Landscape</h4>
                      <span class="tooltip ml-auto">
                        <svg class="w-4 h-4 text-blue-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="tooltiptext">Macro-level external pressures: economic shifts, political trends, demographic changes forcing the system to adapt.</span>
                      </span>
                    </div>
                    <p class="text-xs text-blue-200/70 mb-4">External pressures forcing change</p>
                    <div id="landscape-list" class="space-y-2 min-h-[200px] drop-zone" data-category="landscape" ondrop="dropStakeholder(event)" ondragover="allowDrop(event)"></div>
                    <button onclick="addStakeholder('landscape')" class="mt-3 w-full px-3 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 rounded-lg text-sm transition-colors">
                      + Add Factor
                    </button>
                </div>

                <div class="bg-gradient-to-br from-amber-500/10 to-amber-600/5 p-4 rounded-xl border border-amber-500/20">
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                      <h4 class="text-amber-300 font-bold uppercase text-sm">Regime</h4>
                      <span class="tooltip ml-auto">
                        <svg class="w-4 h-4 text-amber-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="tooltiptext">Established actors maintaining status quo: RDCs, DepEd/TESDA regional offices, business chambers with vested interests.</span>
                      </span>
                    </div>
                    <p class="text-xs text-amber-200/70 mb-4">Status quo actors & institutions</p>
                    <div id="regime-list" class="space-y-2 min-h-[200px] drop-zone" data-category="regime" ondrop="dropStakeholder(event)" ondragover="allowDrop(event)"></div>
                    <button onclick="addStakeholder('regime')" class="mt-3 w-full px-3 py-2 bg-amber-500/20 hover:bg-amber-500/30 text-amber-300 rounded-lg text-sm transition-colors">
                      + Add Actor
                    </button>
                </div>

                <div class="bg-gradient-to-br from-emerald-500/10 to-emerald-600/5 p-4 rounded-xl border border-emerald-500/20">
                    <div class="flex items-center gap-2 mb-3">
                      <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                      <h4 class="text-emerald-300 font-bold uppercase text-sm">Niche</h4>
                      <span class="tooltip ml-auto">
                        <svg class="w-4 h-4 text-emerald-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="tooltiptext">Innovators and outliers ready for change: progressive schools, reform-minded LGUs, industry partners seeking new pathways.</span>
                      </span>
                    </div>
                    <p class="text-xs text-emerald-200/70 mb-4">Innovators ready for transformation</p>
                    <div id="niche-list" class="space-y-2 min-h-[200px] drop-zone" data-category="niche" ondrop="dropStakeholder(event)" ondragover="allowDrop(event)"></div>
                    <button onclick="addStakeholder('niche')" class="mt-3 w-full px-3 py-2 bg-emerald-500/20 hover:bg-emerald-500/30 text-emerald-300 rounded-lg text-sm transition-colors">
                      + Add Innovator
                    </button>
                </div>
            </div>
            
            <div class="bg-white/5 border border-white/10 rounded-xl p-4">
              <h4 class="font-semibold text-white mb-2">Analysis Notes</h4>
              <textarea id="rnl-notes" rows="3" placeholder="Document key insights about stakeholder dynamics, power relationships, and change potential..." class="text-sm"></textarea>
            </div>`;
        }
        
        else if (type === 'desk') {
            document.getElementById('tool-title').textContent = 'Desk Review Synthesis';
            html += `
            <div class="space-y-6">
              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <label class="block text-white font-semibold mb-2">National E2E Trends</label>
                <p class="text-sm text-slate-400 mb-3">Document labor market failures, curriculum gaps, and standard technical issues across the Philippines.</p>
                <textarea id="desk-national" rows="4" placeholder="e.g., Skills mismatch in manufacturing sector, outdated SHS curricula, low industry engagement..." class="text-sm">${appData.stage1.deskReview.nationalTrends}</textarea>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <label class="block text-white font-semibold mb-2">Regional Political Contexts</label>
                <p class="text-sm text-slate-400 mb-3">Unique power dynamics in the six priority regions (NCR, 1, 2, 3, 4-B, and 7).</p>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="text-sm text-slate-300 mb-1 block">NCR</label>
                    <textarea rows="2" placeholder="Political settlement notes for NCR..." class="text-sm"></textarea>
                  </div>
                  <div>
                    <label class="text-sm text-slate-300 mb-1 block">Region 1</label>
                    <textarea rows="2" placeholder="Political settlement notes for Region 1..." class="text-sm"></textarea>
                  </div>
                  <div>
                    <label class="text-sm text-slate-300 mb-1 block">Region 2</label>
                    <textarea rows="2" placeholder="Political settlement notes for Region 2..." class="text-sm"></textarea>
                  </div>
                  <div>
                    <label class="text-sm text-slate-300 mb-1 block">Region 3</label>
                    <textarea rows="2" placeholder="Political settlement notes for Region 3..." class="text-sm"></textarea>
                  </div>
                  <div>
                    <label class="text-sm text-slate-300 mb-1 block">Region 4-B</label>
                    <textarea rows="2" placeholder="Political settlement notes for Region 4-B..." class="text-sm"></textarea>
                  </div>
                  <div>
                    <label class="text-sm text-slate-300 mb-1 block">Region 7</label>
                    <textarea rows="2" placeholder="Political settlement notes for Region 7..." class="text-sm"></textarea>
                  </div>
                </div>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <label class="block text-white font-semibold mb-2">Preliminary "Lock-ins"</label>
                <p class="text-sm text-slate-400 mb-3">Early identification of informal norms, institutional habits, and political settlements.</p>
                <textarea id="desk-lockins" rows="4" placeholder="e.g., Elite capture of training funds, informal quota systems, patron-client relationships..." class="text-sm">${appData.stage1.deskReview.preliminaryLockIns}</textarea>
              </div>
            </div>`;
        }

        // ============================================
        // STAGE 2 TOOLS
        // ============================================
        
        else if (type === 'readiness') {
            document.getElementById('tool-title').textContent = 'Systemic Readiness Assessment';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Assess a school or division's capacity to partner with industry and local communities. This filters for "partnership potential" based on three key criteria.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div>
                <label class="block text-white font-semibold mb-2">School/Division Name</label>
                <input type="text" id="readiness-entity" placeholder="e.g., DepEd Division of Manila" class="text-sm">
              </div>
              <div>
                <label class="block text-white font-semibold mb-2">Region</label>
                <select id="readiness-region" class="text-sm">
                  <option value="">Select Region</option>
                  <option value="NCR">NCR</option>
                  <option value="1">Region 1</option>
                  <option value="2">Region 2</option>
                  <option value="3">Region 3</option>
                  <option value="4B">Region 4-B</option>
                  <option value="7">Region 7</option>
                </select>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <div class="flex items-center gap-2 mb-4">
                  <svg class="w-5 h-5 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                  <h4 class="text-violet-300 font-bold">Political Will</h4>
                </div>
                <p class="text-sm text-slate-300 mb-3">Willingness of leaders to challenge Regime norms and existing power structures.</p>
                <div class="space-y-3">
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="will-1" class="w-4 h-4">
                    <label for="will-1" class="text-sm text-slate-300">Leadership demonstrates openness to reform</label>
                  </div>
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="will-2" class="w-4 h-4">
                    <label for="will-2" class="text-sm text-slate-300">Has challenged status quo practices before</label>
                  </div>
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="will-3" class="w-4 h-4">
                    <label for="will-3" class="text-sm text-slate-300">Shows independence from political patronage</label>
                  </div>
                </div>
                <div class="mt-4">
                  <label class="block text-sm text-slate-300 mb-2">Score (1-10):</label>
                  <input type="range" id="will-score" min="1" max="10" value="5" class="w-full" oninput="updateScore('will')">
                  <div class="text-center text-violet-300 font-bold text-2xl mt-2" id="will-score-display">5</div>
                </div>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <div class="flex items-center gap-2 mb-4">
                  <svg class="w-5 h-5 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                  <h4 class="text-violet-300 font-bold">Partnership Capacity</h4>
                </div>
                <p class="text-sm text-slate-300 mb-3">Ability to work with LGUs, industry partners, and training providers.</p>
                <div class="space-y-3">
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="partner-1" class="w-4 h-4">
                    <label for="partner-1" class="text-sm text-slate-300">Existing industry partnerships</label>
                  </div>
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="partner-2" class="w-4 h-4">
                    <label for="partner-2" class="text-sm text-slate-300">Active LGU collaboration</label>
                  </div>
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="partner-3" class="w-4 h-4">
                    <label for="partner-3" class="text-sm text-slate-300">Multi-stakeholder coordination mechanisms</label>
                  </div>
                </div>
                <div class="mt-4">
                  <label class="block text-sm text-slate-300 mb-2">Score (1-10):</label>
                  <input type="range" id="partner-score" min="1" max="10" value="5" class="w-full" oninput="updateScore('partner')">
                  <div class="text-center text-violet-300 font-bold text-2xl mt-2" id="partner-score-display">5</div>
                </div>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <div class="flex items-center gap-2 mb-4">
                  <svg class="w-5 h-5 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                  <h4 class="text-violet-300 font-bold">Niche Potential</h4>
                </div>
                <p class="text-sm text-slate-300 mb-3">Pre-conditions to successfully prototype and scale context-sensitive solutions.</p>
                <div class="space-y-3">
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="niche-1" class="w-4 h-4">
                    <label for="niche-1" class="text-sm text-slate-300">History of innovation/piloting</label>
                  </div>
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="niche-2" class="w-4 h-4">
                    <label for="niche-2" class="text-sm text-slate-300">Sufficient autonomy from central directives</label>
                  </div>
                  <div class="flex items-center gap-3">
                    <input type="checkbox" id="niche-3" class="w-4 h-4">
                    <label for="niche-3" class="text-sm text-slate-300">Community support for change</label>
                  </div>
                </div>
                <div class="mt-4">
                  <label class="block text-sm text-slate-300 mb-2">Score (1-10):</label>
                  <input type="range" id="niche-score" min="1" max="10" value="5" class="w-full" oninput="updateScore('niche')">
                  <div class="text-center text-violet-300 font-bold text-2xl mt-2" id="niche-score-display">5</div>
                </div>
              </div>

              <div class="score-display">
                <div class="text-sm text-slate-300 mb-2">OVERALL READINESS SCORE</div>
                <div class="score-value" id="overall-readiness">5.0</div>
                <div class="text-sm text-slate-400 mt-2" id="readiness-recommendation">Moderate readiness for partnership</div>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                <label class="block text-white font-semibold mb-2">Additional Notes</label>
                <textarea rows="3" placeholder="Document specific observations, contextual factors, or follow-up actions..." class="text-sm"></textarea>
              </div>
            </div>`;
        }

        else if (type === 'kii') {
            document.getElementById('tool-title').textContent = 'KII & FGD Guide';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Semi-structured interview guide designed for conflict-sensitive dialogue about power dynamics and political settlements.</p>
            </div>

            <div class="space-y-6">
              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <h4 class="text-white font-bold mb-4">Interview Details</h4>
                <div class="grid md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Respondent Name/Code</label>
                    <input type="text" placeholder="e.g., KII-NCR-001" class="text-sm">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Role/Position</label>
                    <input type="text" placeholder="e.g., School Principal, RDC Member" class="text-sm">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Date</label>
                    <input type="date" class="text-sm">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Location/Region</label>
                    <select class="text-sm">
                      <option>NCR</option>
                      <option>Region 1</option>
                      <option>Region 2</option>
                      <option>Region 3</option>
                      <option>Region 4-B</option>
                      <option>Region 7</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <h4 class="text-violet-300 font-bold mb-4 flex items-center gap-2">
                  <span class="w-6 h-6 rounded-full bg-violet-500 text-white flex items-center justify-center text-sm">1</span>
                  Informal Rules & Political Settlements
                </h4>
                <p class="text-sm text-slate-300 mb-3 italic">"What informal rules or 'political settlements' among regional elites dictate how SHS resources are actually allocated?"</p>
                <textarea rows="4" placeholder="Document respondent's insights about informal power structures..." class="text-sm"></textarea>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <h4 class="text-violet-300 font-bold mb-4 flex items-center gap-2">
                  <span class="w-6 h-6 rounded-full bg-violet-500 text-white flex items-center justify-center text-sm">2</span>
                  Private Sector Barriers
                </h4>
                <p class="text-sm text-slate-300 mb-3 italic">"What specific incentives or barriers prevent the private sector from collaborating deeply with local DepEd divisions?"</p>
                <textarea rows="4" placeholder="Capture insights about industry engagement challenges..." class="text-sm"></textarea>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <h4 class="text-violet-300 font-bold mb-4 flex items-center gap-2">
                  <span class="w-6 h-6 rounded-full bg-violet-500 text-white flex items-center justify-center text-sm">3</span>
                  Change Champions & Resistance
                </h4>
                <p class="text-sm text-slate-300 mb-3 italic">"Who are the local champions pushing for reform, and what resistance do they face?"</p>
                <textarea rows="4" placeholder="Identify change agents and sources of resistance..." class="text-sm"></textarea>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-6">
                <h4 class="text-violet-300 font-bold mb-4 flex items-center gap-2">
                  <span class="w-6 h-6 rounded-full bg-violet-500 text-white flex items-center justify-center text-sm">4</span>
                  Success Stories & Outliers
                </h4>
                <p class="text-sm text-slate-300 mb-3 italic">"Can you point to any schools or initiatives that have successfully challenged the status quo?"</p>
                <textarea rows="4" placeholder="Document niche innovations and success factors..." class="text-sm"></textarea>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                <h4 class="text-white font-semibold mb-2">Follow-up Notes & Observations</h4>
                <textarea rows="3" placeholder="Non-verbal cues, additional context, sensitive information..." class="text-sm"></textarea>
              </div>
            </div>`;
        }

        else if (type === 'transcribe') {
            document.getElementById('tool-title').textContent = 'Transcription Service';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Capture and organize field interview transcripts to preserve nuance and informal institutional habits.</p>
            </div>

            <div class="space-y-6">
              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <h4 class="text-white font-bold mb-4">Upload Audio/Video</h4>
                <div class="border-2 border-dashed border-white/20 rounded-xl p-8 text-center drop-zone">
                  <svg class="w-12 h-12 mx-auto mb-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                  <p class="text-slate-400 mb-2">Drag and drop files here or click to browse</p>
                  <p class="text-xs text-slate-500">Supports MP3, MP4, WAV, M4A (Max 500MB)</p>
                  <input type="file" class="hidden" accept="audio/*,video/*">
                </div>
              </div>

              <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                  <label class="block text-sm text-slate-300 mb-2">Interview Code</label>
                  <input type="text" placeholder="e.g., INT-NCR-20260203-001" class="text-sm">
                </div>
                <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                  <label class="block text-sm text-slate-300 mb-2">Duration</label>
                  <input type="text" placeholder="e.g., 45 minutes" class="text-sm">
                </div>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <h4 class="text-white font-bold mb-4">Manual Transcript Entry</h4>
                <textarea rows="12" placeholder="Paste or type interview transcript here... Include timestamps and speaker labels for clarity." class="text-sm font-mono"></textarea>
              </div>

              <div class="bg-violet-500/10 border border-violet-500/20 rounded-xl p-4">
                <h4 class="text-violet-300 font-semibold mb-3">Key Quotes & Insights</h4>
                <p class="text-sm text-slate-400 mb-3">Extract notable quotes that reveal informal rules or power dynamics:</p>
                <div class="space-y-2" id="quotes-list">
                  <div class="flex gap-2">
                    <input type="text" placeholder="Enter a key quote..." class="text-sm flex-1">
                    <button class="btn-secondary text-xs">Add</button>
                  </div>
                </div>
              </div>
            </div>`;
        }

        // ============================================
        // STAGE 3 TOOLS
        // ============================================
        
        else if (type === 'aii') {
            document.getElementById('tool-title').textContent = 'AII Analysis Matrix';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Synthesize field data using the Actors-Institutions-Ideas framework to distinguish between regional constraints and unique local dynamics.</p>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="border-b-2 border-pink-500/30">
                            <th class="p-4 text-left text-pink-400 font-bold w-32">Component</th>
                            <th class="p-4 text-left text-slate-300 w-64">Analysis Focus</th>
                            <th class="p-4 text-left text-slate-300">Field Findings</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                        <tr class="bg-white/5 hover:bg-white/10 transition-colors">
                            <td class="p-4">
                              <div class="flex items-center gap-2">
                                <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
                                  <svg class="w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                                </div>
                                <div>
                                  <div class="font-bold text-white">Actors</div>
                                  <div class="text-xs text-slate-500">Who</div>
                                </div>
                              </div>
                            </td>
                            <td class="p-4">
                              <p class="text-slate-400 text-sm">Interests, incentives, and influence of state and non-state stakeholders.</p>
                              <div class="mt-2 text-xs text-pink-300">Key questions: Who wins? Who loses? Who has power?</div>
                            </td>
                            <td class="p-4">
                              <textarea id="aii-actors" rows="4" placeholder="Document stakeholder interests, vested benefits, power dynamics..." class="text-sm">${appData.stage3.aii.actors}</textarea>
                            </td>
                        </tr>
                        <tr class="bg-white/5 hover:bg-white/10 transition-colors">
                            <td class="p-4">
                              <div class="flex items-center gap-2">
                                <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
                                  <svg class="w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                                </div>
                                <div>
                                  <div class="font-bold text-white">Institutions</div>
                                  <div class="text-xs text-slate-500">Rules</div>
                                </div>
                              </div>
                            </td>
                            <td class="p-4">
                              <p class="text-slate-400 text-sm">Formal rules versus informal norms - the "rules of the game" that shape behavior.</p>
                              <div class="mt-2 text-xs text-pink-300">Written vs unwritten, what's enforced vs ignored</div>
                            </td>
                            <td class="p-4">
                              <textarea id="aii-institutions" rows="4" placeholder="Formal policies, informal practices, institutional habits..." class="text-sm">${appData.stage3.aii.institutions}</textarea>
                            </td>
                        </tr>
                        <tr class="bg-white/5 hover:bg-white/10 transition-colors">
                            <td class="p-4">
                              <div class="flex items-center gap-2">
                                <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center">
                                  <svg class="w-5 h-5 text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                                </div>
                                <div>
                                  <div class="font-bold text-white">Ideas</div>
                                  <div class="text-xs text-slate-500">Beliefs</div>
                                </div>
                              </div>
                            </td>
                            <td class="p-4">
                              <p class="text-slate-400 text-sm">Narratives and entrenched habits that justify and maintain the status quo.</p>
                              <div class="mt-2 text-xs text-pink-300">Dominant narratives, assumptions, mental models</div>
                            </td>
                            <td class="p-4">
                              <textarea id="aii-ideas" rows="4" placeholder="Prevailing narratives, cultural norms, resistance to change..." class="text-sm">${appData.stage3.aii.ideas}</textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="mt-6 bg-white/5 border border-white/10 rounded-xl p-6">
              <h4 class="text-white font-bold mb-3">Synthesis & Patterns</h4>
              <p class="text-sm text-slate-400 mb-3">What patterns emerge across Actors, Institutions, and Ideas? How do they reinforce each other?</p>
              <textarea rows="4" placeholder="Identify interconnections and systemic patterns..." class="text-sm"></textarea>
            </div>`;
        }
        
        else if (type === 'iceberg') {
            document.getElementById('tool-title').textContent = 'Systemic Constraint Map';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Visualize the "Iceberg" of factors preventing a responsive E2E system - visible technical problems above the surface, hidden systemic lock-ins below.</p>
            </div>
            
            <div class="relative w-full rounded-xl overflow-hidden border border-white/10 bg-gradient-to-b from-slate-900 to-blue-950" style="height: 700px;">
                <!-- Above Water (Visible Symptoms) -->
                <div class="absolute inset-x-0 top-0 p-8 flex flex-col items-center z-10" style="height: 35%;">
                    <div class="w-full max-w-3xl">
                        <div class="flex items-center gap-3 mb-4">
                          <div class="w-12 h-12 rounded-xl bg-slate-700/50 flex items-center justify-center">
                            <svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                          </div>
                          <div>
                            <h3 class="text-white font-bold text-xl">Visible Symptoms</h3>
                            <p class="text-sm text-slate-400">Technical problems that are easily observed</p>
                          </div>
                        </div>
                        <textarea id="iceberg-visible" rows="6" placeholder="e.g., Curriculum gaps, outdated facilities, skills mismatch, low graduation rates, poor industry engagement..." class="text-sm bg-slate-800/50">${appData.stage3.iceberg.visible}</textarea>
                    </div>
                </div>
                
                <!-- Water Line -->
                <div class="absolute inset-x-0 iceberg-water z-5" style="top: 35%; bottom: 0;">
                  <div class="absolute inset-x-0 top-0 h-px bg-gradient-to-r from-transparent via-cyan-400 to-transparent"></div>
                  <svg class="absolute inset-x-0 top-0 w-full h-16 opacity-30" viewBox="0 0 1440 120">
                    <path fill="#38bdf8" d="M0,32L48,37.3C96,43,192,53,288,58.7C384,64,480,64,576,58.7C672,53,768,43,864,42.7C960,43,1056,53,1152,58.7C1248,64,1344,64,1392,64L1440,64L1440,120L1392,120C1344,120,1248,120,1152,120C1056,120,960,120,864,120C768,120,672,120,576,120C480,120,384,120,288,120C192,120,96,120,48,120L0,120Z"></path>
                  </svg>
                </div>
                
                <!-- Below Water (Hidden Lock-ins) -->
                <div class="absolute inset-x-0 bottom-0 p-8 flex flex-col items-center z-10" style="top: 40%; overflow-y: auto;">
                    <div class="w-full max-w-3xl">
                        <div class="flex items-center gap-3 mb-4">
                          <div class="w-12 h-12 rounded-xl bg-blue-900/80 flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path></svg>
                          </div>
                          <div>
                            <h3 class="text-white font-bold text-xl">Hidden Lock-ins</h3>
                            <p class="text-sm text-blue-200">Systemic constraints below the surface</p>
                          </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-4">
                          <div>
                            <label class="block text-blue-200 font-semibold mb-2 text-sm">Informal Power Structures</label>
                            <textarea rows="5" placeholder="e.g., Elite capture, patron-client networks, political settlements..." class="text-sm bg-blue-900/40 border-blue-500/30"></textarea>
                          </div>
                          <div>
                            <label class="block text-blue-200 font-semibold mb-2 text-sm">Institutional Habits</label>
                            <textarea rows="5" placeholder="e.g., Bureaucratic inertia, risk aversion, turf protection..." class="text-sm bg-blue-900/40 border-blue-500/30"></textarea>
                          </div>
                          <div>
                            <label class="block text-blue-200 font-semibold mb-2 text-sm">Vested Interests</label>
                            <textarea rows="5" placeholder="e.g., Resource gatekeeping, rent-seeking, status quo benefits..." class="text-sm bg-blue-900/40 border-blue-500/30"></textarea>
                          </div>
                          <div>
                            <label class="block text-blue-200 font-semibold mb-2 text-sm">Cultural Norms</label>
                            <textarea rows="5" placeholder="e.g., Hierarchical decision-making, risk aversion, innovation resistance..." class="text-sm bg-blue-900/40 border-blue-500/30"></textarea>
                          </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-pink-500/10 border border-pink-500/20 rounded-xl p-6">
              <h4 class="text-pink-300 font-bold mb-3">Strategic Implications</h4>
              <p class="text-sm text-slate-300 mb-3">How do these hidden lock-ins shape what reforms are politically feasible? What needs to change below the waterline?</p>
              <textarea rows="4" placeholder="Analyze how hidden constraints must be addressed for sustainable reform..." class="text-sm"></textarea>
            </div>`;
        }

        // ============================================
        // STAGE 4 TOOLS
        // ============================================
        
        else if (type === 'validation') {
            document.getElementById('tool-title').textContent = 'Stakeholder Validation Workshop';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Present findings to regional state and non-state actors for iterative feedback. Test political viability and build consensus.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6 mb-6">
              <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                <label class="block text-sm text-slate-300 mb-2">Workshop Date</label>
                <input type="date" class="text-sm">
              </div>
              <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                <label class="block text-sm text-slate-300 mb-2">Region</label>
                <select class="text-sm">
                  <option>NCR</option>
                  <option>Region 1</option>
                  <option>Region 2</option>
                  <option>Region 3</option>
                  <option>Region 4-B</option>
                  <option>Region 7</option>
                </select>
              </div>
            </div>

            <div class="space-y-6">
              <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-6">
                <h4 class="text-emerald-300 font-bold mb-4">Resonance Check</h4>
                <p class="text-sm text-slate-300 mb-3 italic">"Does our analysis of power structures resonate with your experience, or are there hidden 'Regime' interests not yet accounted for?"</p>
                <textarea rows="4" placeholder="Document stakeholder responses and corrections to the analysis..." class="text-sm"></textarea>
              </div>

              <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-6">
                <h4 class="text-emerald-300 font-bold mb-4">Political Feasibility Assessment</h4>
                <p class="text-sm text-slate-300 mb-3">Which proposed reforms are politically viable in the current context?</p>
                <div class="space-y-3">
                  <div class="bg-white/5 p-3 rounded-lg">
                    <input type="text" placeholder="Proposed Reform 1" class="text-sm mb-2">
                    <div class="flex items-center gap-4">
                      <label class="flex items-center gap-2">
                        <input type="radio" name="feasibility-1" value="high">
                        <span class="text-sm text-emerald-300">High Feasibility</span>
                      </label>
                      <label class="flex items-center gap-2">
                        <input type="radio" name="feasibility-1" value="medium">
                        <span class="text-sm text-amber-300">Medium</span>
                      </label>
                      <label class="flex items-center gap-2">
                        <input type="radio" name="feasibility-1" value="low">
                        <span class="text-sm text-red-300">Low</span>
                      </label>
                    </div>
                  </div>
                </div>
                <button class="mt-3 btn-secondary text-sm">+ Add Reform Proposal</button>
              </div>

              <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-6">
                <h4 class="text-emerald-300 font-bold mb-4">Stakeholder Concerns & Objections</h4>
                <textarea rows="5" placeholder="Document reservations, political sensitivities, and points of resistance..." class="text-sm"></textarea>
              </div>

              <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-6">
                <h4 class="text-emerald-300 font-bold mb-4">Consensus Areas</h4>
                <textarea rows="4" placeholder="Identify areas of agreement and shared priorities..." class="text-sm"></textarea>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-4">
                <h4 class="text-white font-semibold mb-3">Next Steps & Follow-up Actions</h4>
                <textarea rows="3" placeholder="Document agreed-upon action items and timeline..." class="text-sm"></textarea>
              </div>
            </div>`;
        }

        else if (type === 'resistance') {
            document.getElementById('tool-title').textContent = 'Resistance Mapping';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Identify potential resistance from status quo actors and develop mitigation strategies to ensure political viability.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <div class="space-y-4">
                <h4 class="text-white font-bold flex items-center gap-2">
                  <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                  Potential Resistance Sources
                </h4>
                
                <div class="bg-red-500/10 border border-red-500/20 rounded-xl p-4">
                  <label class="block text-sm text-slate-300 mb-2">Actor/Group</label>
                  <input type="text" placeholder="e.g., Regional Business Chamber" class="text-sm mb-3">
                  <label class="block text-sm text-slate-300 mb-2">Nature of Resistance</label>
                  <textarea rows="2" placeholder="Why would they resist? What do they stand to lose?" class="text-sm mb-3"></textarea>
                  <label class="block text-sm text-slate-300 mb-2">Resistance Level</label>
                  <select class="text-sm mb-3">
                    <option>Low</option>
                    <option>Medium</option>
                    <option>High</option>
                    <option>Critical</option>
                  </select>
                  <button class="btn-secondary text-sm w-full">Add to Map</button>
                </div>

                <div id="resistance-list" class="space-y-2">
                  <!-- Resistance items will be added here -->
                </div>
              </div>

              <div class="space-y-4">
                <h4 class="text-white font-bold flex items-center gap-2">
                  <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path></svg>
                  Mitigation Strategies
                </h4>

                <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-4 space-y-4">
                  <div>
                    <label class="block text-sm text-emerald-300 mb-2 font-semibold">Engagement Strategy</label>
                    <textarea rows="3" placeholder="How can we engage this actor constructively?" class="text-sm"></textarea>
                  </div>

                  <div>
                    <label class="block text-sm text-emerald-300 mb-2 font-semibold">Value Proposition</label>
                    <textarea rows="3" placeholder="What benefits can we emphasize? How can we reframe the reform?" class="text-sm"></textarea>
                  </div>

                  <div>
                    <label class="block text-sm text-emerald-300 mb-2 font-semibold">Coalition Building</label>
                    <textarea rows="3" placeholder="Who are potential allies that can help neutralize resistance?" class="text-sm"></textarea>
                  </div>

                  <div>
                    <label class="block text-sm text-emerald-300 mb-2 font-semibold">Tactical Adjustments</label>
                    <textarea rows="3" placeholder="Should we modify the reform approach to reduce resistance?" class="text-sm"></textarea>
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-6 bg-white/5 border border-white/10 rounded-xl p-6">
              <h4 class="text-white font-bold mb-3">Overall Political Viability Assessment</h4>
              <div class="grid md:grid-cols-3 gap-4 mb-4">
                <div class="text-center p-4 bg-red-500/10 rounded-lg border border-red-500/20">
                  <div class="text-3xl font-bold text-red-400">3</div>
                  <div class="text-sm text-slate-400">High Resistance</div>
                </div>
                <div class="text-center p-4 bg-amber-500/10 rounded-lg border border-amber-500/20">
                  <div class="text-3xl font-bold text-amber-400">5</div>
                  <div class="text-sm text-slate-400">Medium Resistance</div>
                </div>
                <div class="text-center p-4 bg-emerald-500/10 rounded-lg border border-emerald-500/20">
                  <div class="text-3xl font-bold text-emerald-400">2</div>
                  <div class="text-sm text-slate-400">Low Resistance</div>
                </div>
              </div>
              <textarea rows="3" placeholder="Summary of overall political risks and mitigation plan..." class="text-sm"></textarea>
            </div>`;
        }

        else if (type === 'consensus') {
            document.getElementById('tool-title').textContent = 'Consensus Tracker';
            html += `
            <div class="mb-6">
              <p class="text-slate-400 text-sm">Track stakeholder feedback and build ownership for reform implementation across multiple validation sessions.</p>
            </div>

            <div class="grid gap-6">
              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <h4 class="text-white font-bold mb-4">Stakeholder Registry</h4>
                <div class="overflow-x-auto">
                  <table class="w-full text-sm">
                    <thead class="border-b border-white/10">
                      <tr>
                        <th class="text-left p-3 text-slate-400 font-semibold">Stakeholder</th>
                        <th class="text-left p-3 text-slate-400 font-semibold">Role</th>
                        <th class="text-left p-3 text-slate-400 font-semibold">Position</th>
                        <th class="text-left p-3 text-slate-400 font-semibold">Influence</th>
                        <th class="text-left p-3 text-slate-400 font-semibold">Engagement</th>
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5">
                      <tr class="hover:bg-white/5">
                        <td class="p-3 text-white">Example Stakeholder</td>
                        <td class="p-3 text-slate-300">DepEd Regional Director</td>
                        <td class="p-3">
                          <span class="px-2 py-1 bg-emerald-500/20 text-emerald-300 rounded text-xs">Supportive</span>
                        </td>
                        <td class="p-3">
                          <span class="px-2 py-1 bg-amber-500/20 text-amber-300 rounded text-xs">High</span>
                        </td>
                        <td class="p-3">
                          <span class="px-2 py-1 bg-blue-500/20 text-blue-300 rounded text-xs">Active</span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <button class="mt-4 btn-secondary text-sm">+ Add Stakeholder</button>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-emerald-500/10 border border-emerald-500/20 rounded-xl p-6">
                  <h4 class="text-emerald-300 font-bold mb-4">Points of Consensus</h4>
                  <p class="text-sm text-slate-300 mb-3">Areas where stakeholders agree and support proposed reforms:</p>
                  <div class="space-y-2" id="consensus-list">
                    <div class="bg-white/5 p-3 rounded-lg">
                      <input type="text" placeholder="Enter consensus point..." class="text-sm">
                    </div>
                  </div>
                  <button class="mt-3 btn-secondary text-sm">+ Add Point</button>
                </div>

                <div class="bg-amber-500/10 border border-amber-500/20 rounded-xl p-6">
                  <h4 class="text-amber-300 font-bold mb-4">Contested Areas</h4>
                  <p class="text-sm text-slate-300 mb-3">Issues requiring further dialogue or compromise:</p>
                  <div class="space-y-2" id="contested-list">
                    <div class="bg-white/5 p-3 rounded-lg">
                      <input type="text" placeholder="Enter contested issue..." class="text-sm">
                    </div>
                  </div>
                  <button class="mt-3 btn-secondary text-sm">+ Add Issue</button>
                </div>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <h4 class="text-white font-bold mb-4">Ownership & Champion Identification</h4>
                <p class="text-sm text-slate-400 mb-4">Who are the champions willing to lead implementation in each region?</p>
                <div class="grid md:grid-cols-3 gap-4">
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Region</label>
                    <select class="text-sm">
                      <option>NCR</option>
                      <option>Region 1</option>
                      <option>Region 2</option>
                      <option>Region 3</option>
                      <option>Region 4-B</option>
                      <option>Region 7</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Champion Name</label>
                    <input type="text" placeholder="Name and organization" class="text-sm">
                  </div>
                  <div>
                    <label class="block text-sm text-slate-300 mb-2">Commitment Level</label>
                    <select class="text-sm">
                      <option>Strong</option>
                      <option>Moderate</option>
                      <option>Tentative</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="bg-white/5 border border-white/10 rounded-xl p-6">
                <h4 class="text-white font-bold mb-3">Feedback Integration Log</h4>
                <p class="text-sm text-slate-400 mb-4">How has stakeholder feedback been incorporated into the final recommendations?</p>
                <textarea rows="5" placeholder="Document changes made based on validation feedback, compromises reached, and rationale for decisions..." class="text-sm"></textarea>
              </div>
            </div>`;
        }

        else {
            html += `<div class="text-center py-20 text-slate-500">
                <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                <p>Tool interface for ${type} is loading...</p>
            </div>`;
        }
        
        html += `<div class="mt-6 flex justify-end gap-3 pt-4 border-t border-white/10">
            <button class="btn-secondary" onclick="closeModal()">Close</button>
            <button class="btn-primary" onclick="saveToolData('${type}')">
              <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
              Save Analysis
            </button>
        </div>`;

        content.innerHTML = html;

        // Initialize tool-specific functionality
        if (type === 'rnl') {
          loadRNLData();
        } else if (type === 'readiness') {
          updateOverallReadiness();
        }
    }

    // ============================================
    // RNL MATRIX FUNCTIONALITY
    // ============================================
    function loadRNLData() {
      ['landscape', 'regime', 'niche'].forEach(category => {
        const list = document.getElementById(`${category}-list`);
        appData.stage1[category].forEach((item, index) => {
          const card = createStakeholderCard(item, category, index);
          list.innerHTML += card;
        });
      });
    }

    function createStakeholderCard(text, category, index) {
      const colors = {
        landscape: 'blue',
        regime: 'amber',
        niche: 'emerald'
      };
      const color = colors[category];
      return `
        <div class="stakeholder-card bg-${color}-500/10 border border-${color}-500/30 rounded-lg p-3 text-sm text-slate-300" 
             draggable="true" 
             ondragstart="dragStart(event)" 
             data-category="${category}" 
             data-index="${index}">
          <div class="flex justify-between items-start">
            <span>${text}</span>
            <button onclick="removeStakeholder('${category}', ${index})" class="text-${color}-400 hover:text-red-400 transition-colors">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
          </div>
        </div>
      `;
    }

    function addStakeholder(category) {
      const text = prompt(`Enter ${category} factor:`);
      if (text && text.trim()) {
        appData.stage1[category].push(text.trim());
        const list = document.getElementById(`${category}-list`);
        const index = appData.stage1[category].length - 1;
        list.innerHTML += createStakeholderCard(text.trim(), category, index);
        saveState();
      }
    }

    function removeStakeholder(category, index) {
      if (confirm('Remove this item?')) {
        appData.stage1[category].splice(index, 1);
        loadRNLData();
        saveState();
      }
    }

    function dragStart(event) {
      event.dataTransfer.setData('text/plain', JSON.stringify({
        category: event.target.dataset.category,
        index: parseInt(event.target.dataset.index)
      }));
      event.target.style.opacity = '0.5';
    }

    function allowDrop(event) {
      event.preventDefault();
      event.currentTarget.classList.add('drag-over');
    }

    function dropStakeholder(event) {
      event.preventDefault();
      event.currentTarget.classList.remove('drag-over');
      
      const data = JSON.parse(event.dataTransfer.getData('text/plain'));
      const targetCategory = event.currentTarget.dataset.category;
      
      if (data.category !== targetCategory) {
        const item = appData.stage1[data.category][data.index];
        appData.stage1[data.category].splice(data.index, 1);
        appData.stage1[targetCategory].push(item);
        loadRNLData();
        saveState();
      }
    }

    // ============================================
    // READINESS ASSESSMENT FUNCTIONALITY
    // ============================================
    function updateScore(type) {
      const score = document.getElementById(`${type}-score`).value;
      document.getElementById(`${type}-score-display`).textContent = score;
      updateOverallReadiness();
    }

    function updateOverallReadiness() {
      const will = parseInt(document.getElementById('will-score')?.value || 5);
      const partner = parseInt(document.getElementById('partner-score')?.value || 5);
      const niche = parseInt(document.getElementById('niche-score')?.value || 5);
      
      const overall = ((will + partner + niche) / 3).toFixed(1);
      const display = document.getElementById('overall-readiness');
      const recommendation = document.getElementById('readiness-recommendation');
      
      if (display) display.textContent = overall;
      
      if (recommendation) {
        if (overall >= 8) {
          recommendation.textContent = 'High readiness - Priority partner for pilot programs';
          recommendation.className = 'text-sm text-emerald-300 mt-2';
        } else if (overall >= 6) {
          recommendation.textContent = 'Moderate readiness - Consider with capacity building support';
          recommendation.className = 'text-sm text-amber-300 mt-2';
        } else if (overall >= 4) {
          recommendation.textContent = 'Low readiness - Requires significant development before partnership';
          recommendation.className = 'text-sm text-orange-300 mt-2';
        } else {
          recommendation.textContent = 'Not recommended for current partnership - Focus on other divisions';
          recommendation.className = 'text-sm text-red-300 mt-2';
        }
      }
    }

    // ============================================
    // SAVE & EXPORT FUNCTIONALITY
    // ============================================
    function saveToolData(toolType) {
      // Save tool-specific data based on type
      if (toolType === 'desk') {
        appData.stage1.deskReview.nationalTrends = document.getElementById('desk-national')?.value || '';
        appData.stage1.deskReview.preliminaryLockIns = document.getElementById('desk-lockins')?.value || '';
      } else if (toolType === 'aii') {
        appData.stage3.aii.actors = document.getElementById('aii-actors')?.value || '';
        appData.stage3.aii.institutions = document.getElementById('aii-institutions')?.value || '';
        appData.stage3.aii.ideas = document.getElementById('aii-ideas')?.value || '';
      } else if (toolType === 'iceberg') {
        appData.stage3.iceberg.visible = document.getElementById('iceberg-visible')?.value || '';
      }
      
      saveState();
      closeModal();
    }

    function closeModal() {
      document.getElementById('tool-modal').classList.add('hidden');
    }

    // ============================================
    // EXPORT FUNCTIONALITY
    // ============================================
    function exportFullReport() {
      const report = generateFullReport();
      document.getElementById('export-content').textContent = report;
      showToast('Full report generated', 'success');
    }

    function exportStrategicAnnex() {
      const annex = generateStrategicAnnex();
      document.getElementById('export-content').textContent = annex;
      showToast('Strategic Annex generated', 'success');
    }

    function generateFullReport() {
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      return `
   EQUIP POLITICAL ECONOMY ANALYSIS - COMPREHENSIVE REPORT   


Generated: ${date}
Analysis Framework: Actors-Institutions-Ideas (AII)
Regions Covered: NCR, 1, 2, 3, 4-B, 7



EXECUTIVE SUMMARY

This Political Economy Analysis employs systems innovation thinking to
diagnose the "lock-ins" maintaining the status quo in the Education-to-
Employment (E2E) ecosystem while identifying "Niche" actors ready for
transformation.



STAGE 1: REGIME-NICHE-LANDSCAPE MAPPING

LANDSCAPE FACTORS (External Pressures):
${appData.stage1.landscape.map((item, i) => `${i + 1}. ${item}`).join('\n') || 'No data entered'}

REGIME ACTORS (Status Quo):
${appData.stage1.regime.map((item, i) => `${i + 1}. ${item}`).join('\n') || 'No data entered'}

NICHE INNOVATORS (Change Agents):
${appData.stage1.niche.map((item, i) => `${i + 1}. ${item}`).join('\n') || 'No data entered'}

PRELIMINARY LOCK-INS:
${appData.stage1.deskReview.preliminaryLockIns || 'No data entered'}



STAGE 2: FIELD DATA SYNTHESIS

Systemic Readiness Assessments: ${appData.stage2.readinessAssessments.length}
Key Informant Interviews: ${appData.stage2.interviews.length}
Transcripts Analyzed: ${appData.stage2.transcripts.length}



STAGE 3: AII FRAMEWORK ANALYSIS

ACTORS (Who):
${appData.stage3.aii.actors || 'No data entered'}

INSTITUTIONS (Rules):
${appData.stage3.aii.institutions || 'No data entered'}

IDEAS (Beliefs):
${appData.stage3.aii.ideas || 'No data entered'}

SYSTEMIC CONSTRAINTS - ICEBERG MODEL

Visible Symptoms (Above Water):
${appData.stage3.iceberg.visible || 'No data entered'}

Hidden Lock-ins (Below Water):
${appData.stage3.iceberg.hidden.join('\n') || 'No data entered'}



STAGE 4: VALIDATION & CONSENSUS

Validation Workshops Conducted: ${appData.stage4.validationFeedback.length}
Resistance Points Identified: ${appData.stage4.resistanceMap.length}
Consensus Areas: ${appData.stage4.consensus.length}



RECOMMENDATIONS

Based on the comprehensive PEA, the following politically feasible
pathways are recommended for pilot implementation:

1. Target "Niche" actors demonstrating high systemic readiness
2. Address hidden lock-ins through coalition building
3. Sequence reforms to minimize resistance from status quo actors
4. Build on existing consensus areas to generate momentum



For detailed implementation guidance, refer to the Strategic Annex.

 2026 EQUIP PEA Platform
Developed by ASilva Innovations`;
    }

    function generateStrategicAnnex() {
      const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
      
      return `
              STRATEGIC ANNEX - IMPLEMENTATION PLAN           


Generated: ${date}
Implementation Timeline: 18 Months (Phase 1)
Priority Regions: NCR + 2 Additional Regions



PHASE 1: PILOT IMPLEMENTATION (Months 1-6)

PRIORITY SCHOOLS/DIVISIONS FOR NCR:
- [School/Division identified through readiness assessment]
- Rationale: High systemic readiness score, existing industry partnerships

PRIORITY SCHOOLS/DIVISIONS FOR REGION [X]:
- [School/Division identified through readiness assessment]
- Rationale: Niche potential, reform-minded leadership

PRIORITY SCHOOLS/DIVISIONS FOR REGION [Y]:
- [School/Division identified through readiness assessment]
- Rationale: Political will, LGU support



PHASE 2: SCALE & CONSOLIDATION (Months 7-12)

Based on pilot learnings, expand to:
- Additional divisions within pilot regions
- Document success factors and adaptation requirements
- Build regional champion network



PHASE 3: REPLICATION (Months 13-18)

- Introduce framework to remaining regions (4-B, 7)
- Codify best practices
- Establish sustainability mechanisms



RESISTANCE MITIGATION STRATEGIES

Critical Success Factor: Managing status quo resistance

Key Strategies:
1. Early engagement with RDC leadership
2. Demonstrate quick wins in pilot sites
3. Build industry champion coalition
4. Frame reforms within existing policy mandates



MONITORING & EVALUATION FRAMEWORK

Quarterly reviews based on:
- Partnership formation indicators
- Industry engagement metrics
- Learner outcome improvements
- Stakeholder satisfaction surveys



RESOURCE REQUIREMENTS

Technical Assistance:
- Field coordinators for each region
- Industry liaison officers
- M&E specialists

Budget Allocation:
- Pilot site support: [Amount]
- Stakeholder engagement: [Amount]
- M&E and documentation: [Amount]



NEXT STEPS

Immediate Actions (Month 1):
1. Finalize MOU with pilot divisions
2. Establish regional coordination mechanisms
3. Launch champion training program
4. Set up M&E baseline



For questions or technical assistance:
Contact: ASilva Innovations
Email: info@asilvainnovations.com
Phone: +639178555134

 2026 EQUIP PEA Platform`;
    }

    // ============================================
    // TOAST NOTIFICATIONS
    // ============================================
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.innerHTML = `
        <div class="flex items-center gap-3">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            ${type === 'success' ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>' : ''}
          </svg>
          <span>${message}</span>
        </div>
      `;
      
      container.appendChild(toast);
      setTimeout(() => toast.classList.add('show'), 100);
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ============================================
    // INITIALIZATION
    // ============================================
    loadState();
    showView('overview');
  </script>
</body>
</html>
